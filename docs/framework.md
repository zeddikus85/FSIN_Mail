# UI Test Framework (Java)

UITests framework представляет собой шаблон проекта на Java 11 для разработки автоматических UI тестов для web приложений и мобильных приложений. 

Общую информацию о UI Test Framework см. [тут](https://axmor-wiki.atlassian.net/wiki/spaces/CTO/pages/14849867792/UI+Test+Framework). 

История измений в UI Test Framework [тут](docs/changes.md). 

## Подготовка проекта

 После того как код скопирован из шаблона в соответствующий проект (см. детали [тут](https://axmor-wiki.atlassian.net/wiki/spaces/CTO/pages/14851375115/UI#%D0%92%D0%BD%D0%B5%D0%B4%D1%80%D0%B5%D0%BD%D0%B8%D0%B5-UI-%D1%82%D0%B5%D1%81%D1%82%D0%BE%D0%B2-%D0%B2-%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5)) необходимо выполнить следуюшие шаги: 

- Установить среду разработки. Рекомендуется использовать JetBrains IntelliJ IDEA Community Edition (устанавливать лучше всего через [JetBrains ToolBox](https://www.jetbrains.com/ru-ru/toolbox-app/)). Но подойдёт и любая другая IDE, поддерживающая разработку на Java.
- После установки IDEA нужно импортировать (File->New->Project From Existing Sources) проект `ui-test-framework-java/src`.
- Далее необходимо установить JDK 11. Проще всего это сделать прямо через IDEA. Для этого заходим в File → Project Structure → SDKs → Add New SDK → Download JDK, выбираем версию 11 и Azul Zulu Community. После скачки в том же самом диалоге Project Structure заходим во вкладку Project и выбираем только что скачанную JDK 11 в выпадающем меню SDK.
- Для проверки того, что всё настроилось правильно, можно щёлкнуть правой кнопкой мыши по модулю `tests` и нажать 'Run All Tests'. Если все тесты запустились и прошли, то всё хорошо.

## Стартовые примеры
Весь код в модуле `tests` - это пример простейших тестов для одного из проектов. Он включен в репозиторий, чтобы новые тесты можно было делать "по подобию". После ознакомления с этими примерами - их следует удалить или адаптировать под условия вашего проекта:
- В папке `tests` находятся классы тестов - просто удалите файлы или переименуйте их под аналаго в вашем проекте.
- В папке `pages` находятся класса типа Page (которые описывают структуру страниц) и Model (которые описывают данные, которыми оперирует странице) -  их также следует либо удалить, либо адаптировать под структуру страниц в вашем проекте
- В папке `controls` находятся "обертки" для сложных контролов, которые часто используются в проекте. Маловероятно, что контрол из стартового примера подойдет к вашему проекту. Можно оставить как пример до тех пор пока не потребуется реализовать свой подобный контрол, затем пример можно удалить
- В папке `shared` находятся базовые классы для классов страниц и классов тестов - тут сами классы необходимо будет оставить, а их содержимое (методы и поля) - можно удалять
- Кроме того меет смысл переименовать модуль tests во что-то более подходящее (например, `prjName-appName-tests`). Переименовывать лучше всего средствами IDE, а не вручную переименовыванием папок (правая кнопка → Refactor → Rename).
- Необходимо скорректировать настройки запуска тестов в файле `test-config.json` (см. описание параметров [тут](https://axmor-wiki.atlassian.net/wiki/spaces/CTO/pages/14849867799/UI)). Самое важное - поменять настройки уровня приложения `app`

Как настраивать локальное окружение для запуска тестов см. [тут](https://axmor-wiki.atlassian.net/wiki/spaces/CTO/pages/14850162716#Local-Run) (актуально только для режима `executionMode=local`).

_Для продвинутых_: если нужно несколько разных групп тестов с разными конфигурациями `test-config.json`, то можно создавать дополнительные модули (например, создать модуль `prjName-appName-tests-mobile`, где будут только мобильные тесты). Все новые модули должны быть добавлены также в `pom.xml` (иначе Maven их не увидит).

## Запуск из командной строки

Для запуска из командной строки, потребуется скачать [Apache Maven](https://maven.apache.org/download.cgi). После распаковки Maven нужно добавить папку `bin` в `PATH`. Также необходимо прописать переменную окружению `JAVA_HOME`, указав в качестве значения путь до JDK 11 (верхняя папка, не `bin`), которая была скачана ранее.
Для проверки работоспособности Maven можно выполнить следующую команду:

```> mvn -version```

Для запуска тестов нужно выполнить следующую команду из папки `src`:

```
> mvn verify
```

Иногда может случаться (редко), что Maven не подхватывает изменения. В таком случае может потребоваться выполнить `mvn clean verify`. На CI/CD лучше всегда запускать с `clean`.

## Реализация тестов

При реализации UI тестов следует следовать общим требованиям написания unit тестов на платформе JUnit 5. Два специфичных для UI тестов момента:

- Класс тестов должен наследоваться от класса `TestBase`
- Доступ к драйверу Selenium осуществляется как `Driver` или `Driver.current()`. В первом случае возвращается "оболочка" над драйвером, во втором - непосдественно экземпляр объекта, предоставляемый Selenium. В целом рекомендуется работать с оболочной, при необходимости ее функциональность можно расширять (см. ниже).

### TestBase.java

Это базовый класс для всех UI тестов. Если вам нужно чтобы какой-то метод, поле, свойство были доступны в каждом тесте - добавьте его сюда.

### TestAppConfig.java

Этот класс отвечает за чтение конфигурационных параметров из секции `app` в конфигурационном файле `test-config.json`. Если у вас появилась необходимость добавить другие параметры, то вам необходимо объявить соответствующие поля и геттеры в этом классе. 

Из кода тестов можно получить актуальную конфигурацию посредством `Driver.appConfig()`

### Driver.java

Этот класс представляет собой оболочку над "драйвером" предоставляемым Selenium'ом. Если вам потребовалось добавить дополнительные методы-помощники, то это следует делать в этом файле.

### GenericActions.java

Этот класс не имеет какого значения для UITest Framework, это просто предложение, где можно разместить общий код, который может быть востребован в различных тестах.

## Особые моменты

Весь проект является портом аналогичной версии UITest Framework, написанной на C# (`ui-test-framework-csharp`). При портировании был сделан большой упор на сохранении всех имён классов и поведения. Все имена параметров в `test-config.json` являются строго одинаковыми (если это не так, то это ошибка). Стоит учитывать, что версия для .NET может быть более актуальной и иметь более полную документацию.